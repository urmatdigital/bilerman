# PRD: BILERMAN.KG

**Product Requirements Document**
**Версия**: 1.0
**Дата**: 2026-01-28
**Статус**: Draft

---

## 1. Введение

### 1.1 Цель документа
Данный PRD описывает требования к трансформации существующей платформы KONOK в BILERMAN.KG — платформу безопасного бронирования жилья в Кыргызстане с функцией эскроу-защиты платежей.

### 1.2 Scope
- Ребрендинг и визуальные изменения
- Новая система платежей с эскроу
- SMS-аутентификация
- Система защиты и гарантий
- Упрощение функционала под MVP

### 1.3 Out of Scope (для MVP)
- Интеграции с Booking.com, Airbnb
- Мобильные приложения (только PWA)
- Микросервисы коммуникаций
- Динамическое ценообразование

---

## 2. Пользовательские роли

### 2.1 Клиент (Guest)
Человек, который ищет и бронирует жильё для отдыха или проживания.

**Потребности:**
- Быстро найти подходящий объект
- Безопасно оплатить
- Получить гарантию возврата при проблемах
- Связаться с арендодателем

### 2.2 Партнёр (Owner/Арендодатель)
Владелец недвижимости, сдающий её в краткосрочную аренду.

**Потребности:**
- Получать клиентов без затрат на рекламу
- Управлять бронированиями и календарём
- Защита от no-show и поздних отмен
- Быстрые выплаты

### 2.3 Администратор (Admin)
Сотрудник BILERMAN.KG, управляющий платформой.

**Потребности:**
- Верификация партнёров и объектов
- Арбитраж споров
- Мониторинг транзакций
- Управление контентом

---

## 3. Функциональные требования

### 3.1 Модуль аутентификации

#### FR-AUTH-001: Регистрация по телефону
- Пользователь вводит номер телефона (+996)
- Система отправляет OTP код (6 цифр) через SMS
- Код действителен 5 минут
- Максимум 3 попытки ввода
- После верификации — создание профиля

#### FR-AUTH-002: Вход по телефону
- Ввод номера телефона
- Получение OTP по SMS
- Автоматический вход при успешной верификации
- Сессия 30 дней (refresh token)

#### FR-AUTH-003: Роли пользователей
- `client` — клиент (по умолчанию при регистрации)
- `partner` — партнёр (после верификации)
- `admin` — администратор (назначается вручную)

#### FR-AUTH-004: Профиль пользователя
- Имя, фамилия
- Номер телефона (верифицированный)
- Email (опционально)
- Аватар
- Язык интерфейса (RU/KY)

---

### 3.2 Модуль объектов недвижимости

#### FR-PROP-001: Создание объекта (партнёр)
- Название объекта
- Тип: квартира, дом, коттедж, A-frame, комната
- Адрес + GPS координаты на карте
- Регион: Бишкек, Иссык-Куль, Каракол, Другое
- Количество гостей (макс)
- Количество спален, кроватей, ванных
- Удобства (чекбоксы)
- Описание (RU, KY)
- Фотографии (минимум 5, максимум 20)
- Цена за сутки (базовая)
- Политика отмены: гибкая, умеренная, строгая

#### FR-PROP-002: Удобства (amenities)
Стандартный набор:
- WiFi, Кондиционер, Отопление, Кухня
- Стиральная машина, Парковка, Бассейн, Баня/сауна
- Мангал, Детская площадка, Вид на горы/озеро
- Близость к пляжу (метры)

#### FR-PROP-003: Календарь доступности
- Просмотр и редактирование по дням
- Статусы: доступно, забронировано, заблокировано
- Возможность блокировать даты вручную
- Автоматическая блокировка при бронировании

#### FR-PROP-004: Ценообразование
- Базовая цена за сутки
- Цена выходных (Пт-Сб) — опционально
- Скидка за неделю (%) — опционально
- Минимальный срок бронирования (ночей)

#### FR-PROP-005: Верификация объекта
- Статусы: на модерации, активен, отклонён, заблокирован
- Админ проверяет: фото, описание, GPS
- При отклонении — причина и возможность исправить

---

### 3.3 Модуль поиска и каталога

#### FR-SEARCH-001: Поиск объектов
Фильтры:
- Регион (Бишкек, Иссык-Куль, Каракол)
- Даты заезда/выезда
- Количество гостей
- Диапазон цены
- Тип объекта
- Удобства
- Рейтинг (минимум)

#### FR-SEARCH-002: Сортировка
- По популярности (кол-во бронирований)
- По цене (возрастание/убывание)
- По рейтингу
- По новизне

#### FR-SEARCH-003: Карта
- Отображение объектов на карте (Mapbox)
- Кластеризация при зуме
- Popup с ценой и фото при наведении
- Переход к детальной странице по клику

#### FR-SEARCH-004: Страница объекта
- Галерея фото (слайдер)
- Название, описание, рейтинг
- Удобства (иконки)
- Карта с локацией
- Календарь доступности
- Калькулятор цены
- Кнопка "Забронировать"
- Отзывы гостей
- Информация о партнёре

---

### 3.4 Модуль бронирования

#### FR-BOOK-001: Создание бронирования
Входные данные:
- ID объекта
- Даты заезда/выезда
- Количество гостей
- Контактные данные (из профиля)
- Комментарий для хозяина (опционально)

Расчёт стоимости:
- Базовая стоимость = цена × ночи
- Сервисный сбор = 10% от базовой
- Итого = базовая + сервисный сбор

#### FR-BOOK-002: Статусы бронирования
```
pending_payment → confirmed → checked_in → checked_out → completed
                     ↓              ↓
                cancelled      dispute
```

- `pending_payment` — ожидает оплаты (15 минут)
- `confirmed` — оплачено, подтверждено
- `checked_in` — гость заселился
- `checked_out` — гость выехал
- `completed` — бронирование завершено, выплата произведена
- `cancelled` — отменено (клиентом или партнёром)
- `dispute` — спор, требует арбитража

#### FR-BOOK-003: Подтверждение заселения
- Партнёр нажимает "Гость заселился" в приложении
- Или автоматически через 2 часа после времени заезда (если не отмечено)
- После check-in средства готовы к выплате

#### FR-BOOK-004: Уведомления
| Событие | Клиент | Партнёр |
|---------|--------|---------|
| Бронирование создано | SMS + Push | SMS + Push |
| Оплата получена | SMS | SMS |
| Напоминание (за 1 день) | SMS | SMS |
| Check-in подтверждён | Push | Push |
| Выплата отправлена | - | SMS |
| Отмена | SMS | SMS |

---

### 3.5 Модуль платежей (ЭСКРОУ)

#### FR-PAY-001: Платёжные методы
- **MBank** — QR-код / Deep link
- **O!Dengi** — мобильный платёж
- **Элсом** — электронный кошелёк
- **Банковские карты** — Visa, MasterCard, Элкарт

#### FR-PAY-002: Эскроу-логика
1. Клиент оплачивает 100% суммы
2. Деньги поступают на эскроу-счёт BILERMAN.KG
3. Статус бронирования → `confirmed`
4. После check-in (подтверждение партнёром):
   - Комиссия 10% остаётся на счёте BILERMAN.KG
   - 90% переводится партнёру в течение 24 часов

#### FR-PAY-003: Выплаты партнёрам
- Партнёр указывает реквизиты (MBank, Элсом, банк. счёт)
- Выплата автоматически после check-in + 24 часа
- Минимальная сумма выплаты: 500 сом
- История выплат в личном кабинете

#### FR-PAY-004: Компенсационный фонд
- 1% от GMV откладывается в резервный фонд
- Используется для экстренных компенсаций
- Лимит на 1 случай: 50,000 сом
- Лимит на клиента в год: 100,000 сом

---

### 3.6 Модуль отмены и неустоек

#### FR-CANCEL-001: Политики отмены (выбирает партнёр)

**Гибкая:**
| Срок до заезда | Возврат клиенту |
|----------------|-----------------|
| > 3 дней | 100% |
| 1-3 дня | 50% |
| < 1 дня | 0% |

**Умеренная:**
| Срок до заезда | Возврат клиенту |
|----------------|-----------------|
| > 14 дней | 100% |
| 7-14 дней | 50% |
| < 7 дней | 0% |

**Строгая:**
| Срок до заезда | Возврат клиенту |
|----------------|-----------------|
| > 30 дней | 100% |
| 14-30 дней | 50% |
| < 14 дней | 0% |

#### FR-CANCEL-002: Отмена партнёром (неустойки)
| Срок до заезда | Возврат клиенту | Штраф партнёру |
|----------------|-----------------|----------------|
| > 14 дней | 100% | 0% |
| 7-14 дней | 100% | 10% от суммы |
| 3-7 дней | 100% | 30% от суммы |
| < 3 дней | 100% | 50% от суммы |
| День заезда | 100% | 100% от суммы |
| Овербукинг | 150% | 50% + блокировка |

#### FR-CANCEL-003: No-show клиента
- Если клиент не заселился и не отменил
- Партнёр получает 100% суммы
- Статус → `completed`

---

### 3.7 Модуль верификации

#### FR-VERIF-001: Верификация партнёра
Уровни:
- **Базовый**: телефон + фото паспорта
- **Подтверждённый**: + документы на собственность
- **Премиум**: + депозит 10,000 сом

Преимущества верификации:
- Значок "Проверенный партнёр"
- Приоритет в поисковой выдаче
- Мгновенные выплаты (для Премиум)

#### FR-VERIF-002: Верификация объекта
- Проверка фотографий на соответствие
- Проверка GPS-координат
- Проверка описания и удобств
- Ручная модерация администратором

#### FR-VERIF-003: Верификация клиента
- **Базовый**: телефон (OTP)
- **Подтверждённый**: + фото паспорта (опционально)

---

### 3.8 Модуль отзывов и рейтингов

#### FR-REVIEW-001: Отзыв клиента
После завершения бронирования клиент может оставить:
- Общий рейтинг (1-5 звёзд)
- Категории: чистота, соответствие описанию, расположение, хозяин
- Текстовый комментарий
- Срок: 14 дней после check-out

#### FR-REVIEW-002: Ответ партнёра
- Партнёр может ответить на отзыв
- Один ответ на отзыв
- Модерация нецензурной лексики

#### FR-REVIEW-003: Рейтинг партнёра
- Средний рейтинг по всем объектам
- Количество завершённых бронирований
- Скорость ответа
- Процент отмен

---

### 3.9 Модуль коммуникации

#### FR-COMM-001: Чат между клиентом и партнёром
- Доступен после создания бронирования
- История сохраняется
- Push-уведомления о новых сообщениях
- Возможность отправить фото

#### FR-COMM-002: SMS-уведомления
Через провайдера (Nikita.kg или аналог):
- OTP коды
- Подтверждение бронирования
- Напоминания
- Важные события

#### FR-COMM-003: Push-уведомления (PWA)
- Новое сообщение в чате
- Изменение статуса бронирования
- Напоминание о заезде/выезде

---

### 3.10 Модуль администрирования

#### FR-ADMIN-001: Dashboard
- Количество бронирований (сегодня, неделя, месяц)
- GMV и выручка
- Новые партнёры/клиенты
- Объекты на модерации
- Активные споры

#### FR-ADMIN-002: Управление партнёрами
- Список всех партнёров
- Статус верификации
- История бронирований
- Возможность заблокировать

#### FR-ADMIN-003: Управление объектами
- Список на модерации
- Одобрить / Отклонить с комментарием
- Редактирование объектов

#### FR-ADMIN-004: Арбитраж споров
- Список активных споров
- Просмотр деталей (бронирование, переписка)
- Принятие решения (возврат клиенту / выплата партнёру / частичный)
- Использование компенсационного фонда

#### FR-ADMIN-005: Финансы
- Транзакции (все платежи)
- Выплаты партнёрам
- Баланс эскроу
- Компенсационный фонд

---

## 4. Нефункциональные требования

### 4.1 Производительность
- Время загрузки страницы: < 3 секунд
- Время ответа API: < 500ms (p95)
- Поддержка 1,000 одновременных пользователей

### 4.2 Безопасность
- HTTPS везде
- JWT токены с refresh
- Rate limiting на API
- Защита от SQL injection, XSS
- Хеширование паролей (bcrypt)
- Row Level Security в БД

### 4.3 Доступность
- Uptime: 99.5%
- Резервное копирование БД: ежедневно
- Мониторинг (Sentry)

### 4.4 Масштабируемость
- Горизонтальное масштабирование backend
- CDN для статики
- Redis для кеширования

### 4.5 Локализация
- Языки: Русский (основной), Кыргызский
- Валюта: Кыргызский сом (KGS)
- Часовой пояс: Asia/Bishkek (UTC+6)

---

## 5. Технические требования

### 5.1 Текущий стек (сохраняем)
- **Frontend**: React 19 + Vite + TypeScript
- **Backend**: FastAPI + Python 3.11
- **Database**: PostgreSQL 15
- **Cache**: Redis 7
- **Хостинг**: Vercel (frontend) + Railway (backend)

### 5.2 Новые интеграции
- **SMS**: Nikita.kg или SMSCenter
- **Платежи**: MBank API, O!Dengi API, Элсом API
- **Карты**: Mapbox GL (уже есть)

### 5.3 Инфраструктура
- Домен: bilerman.kg
- SSL: Let's Encrypt
- CDN: Cloudflare
- Мониторинг: Sentry

---

## 6. Приоритизация (MoSCoW)

### Must Have (MVP):
- [ ] Регистрация/вход по SMS OTP
- [ ] Каталог и поиск объектов
- [ ] Создание и управление объектами
- [ ] Бронирование с эскроу-оплатой
- [ ] Интеграция MBank (минимум 1 платёжный метод)
- [ ] Политики отмены и неустойки
- [ ] Уведомления SMS
- [ ] Админ-панель (базовая)

### Should Have:
- [ ] Все 4 платёжные системы
- [ ] Чат между клиентом и партнёром
- [ ] Отзывы и рейтинги
- [ ] Верификация партнёров
- [ ] Компенсационный фонд

### Could Have:
- [ ] Push-уведомления
- [ ] Расширенная аналитика для партнёров
- [ ] Программа лояльности
- [ ] Реферальная программа

### Won't Have (v1):
- [ ] Интеграции Booking.com/Airbnb
- [ ] Мобильные приложения (native)
- [ ] Динамическое ценообразование
- [ ] Модуль уборки (клинеры)

---

## 7. Acceptance Criteria

### AC-001: Успешное бронирование
```gherkin
Given клиент на странице объекта
When выбирает даты и нажимает "Забронировать"
And оплачивает через MBank
Then бронирование создаётся со статусом "confirmed"
And клиент получает SMS подтверждение
And партнёр получает SMS уведомление
And деньги на эскроу-счёте
```

### AC-002: Отмена клиентом
```gherkin
Given активное бронирование
When клиент отменяет за 5 дней до заезда
And политика отмены "умеренная"
Then возврат 50% на счёт клиента
And статус бронирования "cancelled"
And партнёр получает уведомление
```

### AC-003: Check-in и выплата
```gherkin
Given подтверждённое бронирование
When партнёр нажимает "Гость заселился"
Then статус меняется на "checked_in"
And через 24 часа партнёр получает выплату (90%)
And BILERMAN.KG удерживает комиссию (10%)
```

---

## 8. Глоссарий

| Термин | Определение |
|--------|-------------|
| **Эскроу** | Счёт-посредник, где деньги хранятся до выполнения условий |
| **GMV** | Gross Merchandise Value — общий объём транзакций |
| **OTP** | One-Time Password — одноразовый пароль |
| **No-show** | Неявка гостя без отмены бронирования |
| **Овербукинг** | Двойное бронирование на одни даты |
| **Check-in** | Заселение гостя |
| **Check-out** | Выезд гостя |

---

**Документ подготовлен**: 2026-01-28
**Следующий шаг**: Gap Analysis и Epics & Stories
